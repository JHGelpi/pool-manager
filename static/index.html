<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pool Manager</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
  <header class="header">
    <h1>üèä Pool Manager</h1>
    <span id="statusBadge" class="badge badge-ok">‚óè Online</span>
  </header>

  <div id="app">
    <!-- Tasks Tab -->
    <section id="tab-tasks" class="tab active">
      <div class="section-header">
        <h2>Maintenance Tasks</h2>
        <button id="btnAddTask" class="btn btn-primary">+ Add Task</button>
      </div>

      <div class="card" style="margin-bottom: 1rem;">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="taskSelect">Select Task</label>
          <select id="taskSelect">
            <option value="">Select a task...</option>
          </select>
        </div>
      </div>

      <div id="taskDetailsCard" class="card" style="display: none;">
        <div class="task-details">
          <h3 id="taskDetailName"></h3>
          <p id="taskDetailDescription" style="color: var(--text-muted); margin-bottom: 1rem;"></p>
          
          <div class="info-row">
            <span>Frequency</span>
            <strong id="taskDetailFrequency"></strong>
          </div>
          <div class="info-row">
            <span>Last Completed</span>
            <strong id="taskDetailLastCompleted">Never</strong>
          </div>
          <div class="info-row">
            <span>Days Since Last</span>
            <strong id="taskDetailDaysSince">N/A</strong>
          </div>
          <div class="info-row">
            <span>Next Due Date</span>
            <strong id="taskDetailNextDue"></strong>
          </div>
        </div>

        <button id="btnCompleteTask" class="btn btn-primary" style="margin-top: 1rem; width: 100%;">
          Mark as Completed Today
        </button>
      </div>

      <div id="taskHistoryCard" class="card" style="display: none;">
        <h3 style="margin-bottom: 1rem;">Completion History</h3>
        <div id="taskHistoryTable">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 1px solid var(--border);">
                <th style="text-align: left; padding: 0.75rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.875rem;">Date</th>
                <th style="text-align: left; padding: 0.75rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.875rem;">Days Between</th>
                <th style="text-align: left; padding: 0.75rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.875rem;">Notes</th>
              </tr>
            </thead>
            <tbody id="taskHistoryBody">
            </tbody>
          </table>
        </div>
        <div id="taskHistoryEmpty" style="text-align: center; padding: 2rem; color: var(--text-muted);">
          No completion history yet. Complete this task to start tracking!
        </div>
      </div>

      <div id="tasksLoading" class="loading">Loading tasks...</div>
      <div id="tasksEmpty" class="empty" style="display: none;">
        <p>No tasks yet.</p>
        <button id="btnAddTaskEmpty" class="btn btn-primary btn-lg">Create your first task</button>
      </div>
    </section>

    <!-- Inventory Tab -->
    <section id="tab-inventory" class="tab">
      <div class="section-header">
        <h2>Chemical Inventory</h2>
        <button id="btnAddInventory" class="btn btn-primary">+ Add Item</button>
      </div>

      <div id="inventoryLoading" class="loading">Loading inventory...</div>
      <div id="inventoryList" class="cards-grid"></div>
      <div id="inventoryEmpty" class="empty" style="display: none;">
        <p>No inventory items yet</p>
        <button id="btnAddInventoryEmpty" class="btn btn-primary">Add First Item</button>
      </div>
    </section>

    <!-- Readings Tab -->
    <section id="tab-readings" class="tab">
      <div class="section-header">
        <h2>Water Readings</h2>
      </div>

      <div class="card">
        <form id="readingForm">
          <div class="form-group">
            <label for="readingType">Reading Type</label>
            <select id="readingType" required>
              <option value="">Select type...</option>
            </select>
          </div>

          <div class="form-group">
            <label for="readingValue">Value</label>
            <input id="readingValue" type="number" step="0.01" placeholder="Enter value" required>
            <span id="readingUnit" class="unit"></span>
          </div>

          <div class="form-group">
            <label for="readingDate">Date</label>
            <input id="readingDate" type="date" required>
          </div>

          <button type="submit" class="btn btn-primary">Save Reading</button>
        </form>
      </div>

      <div class="card">
        <canvas id="readingChart" height="250"></canvas>
      </div>
    </section>

    <!-- Settings Tab -->
    <section id="tab-settings" class="tab">
      <div class="section-header">
        <h2>Settings</h2>
      </div>

      <div class="card">
        <div class="info-row">
          <span>API Status</span>
          <strong id="apiStatus">Checking...</strong>
        </div>
        <div class="info-row">
          <span>Database</span>
          <strong id="dbStatus">Checking...</strong>
        </div>
        <div class="info-row">
          <span>Version</span>
          <strong>1.0.0</strong>
        </div>
      </div>
    </section>
  </div>

  <!-- Task Dialog -->
  <dialog id="taskDialog" class="modal">
    <form id="taskForm">
      <h3>Add Maintenance Task</h3>

      <div class="form-group">
        <label for="taskName">Task Name *</label>
        <input id="taskName" name="name" type="text" required placeholder="e.g., Clean filter">
      </div>

      <div class="form-group">
        <label for="taskDescription">Description</label>
        <textarea id="taskDescription" name="description" rows="3" placeholder="Optional notes"></textarea>
      </div>

      <div class="form-group">
        <label for="taskFrequency">Frequency (days) *</label>
        <input id="taskFrequency" name="frequency_days" type="number" min="1" value="7" required>
      </div>

      <div class="form-group">
        <label for="taskDueDate">Next Due Date *</label>
        <input id="taskDueDate" name="next_due_date" type="date" required>
      </div>

      <div class="modal-actions">
        <button type="button" id="taskCancel" class="btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Task</button>
      </div>
    </form>
  </dialog>

  <!-- Inventory Dialog -->
  <dialog id="inventoryDialog" class="modal">
    <form id="inventoryForm">
      <h3>Add Inventory Item</h3>

      <div class="form-group">
        <label for="invName">Chemical Name *</label>
        <input id="invName" name="name" type="text" required placeholder="e.g., Chlorine Tablets">
      </div>

      <div class="form-group">
        <label for="invQuantity">Quantity on Hand *</label>
        <input id="invQuantity" name="quantity_on_hand" type="number" step="0.1" min="0" required>
      </div>

      <div class="form-group">
        <label for="invUnit">Unit *</label>
        <input id="invUnit" name="unit" type="text" required placeholder="e.g., lbs, gallons">
      </div>

      <div class="form-group">
        <label for="invThreshold">Reorder Threshold *</label>
        <input id="invThreshold" name="reorder_threshold" type="number" step="0.1" min="0" required>
      </div>

      <div class="modal-actions">
        <button type="button" id="inventoryCancel" class="btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Item</button>
      </div>
    </form>
  </dialog>

  <!-- Complete Task Dialog -->
  <dialog id="completeTaskDialog" class="modal">
    <form id="completeTaskForm">
      <h3>Complete Task</h3>

      <div class="form-group">
        <label for="completionNotes">Notes (optional)</label>
        <textarea id="completionNotes" name="notes" rows="4" placeholder="Any observations or reminders for next time..."></textarea>
      </div>

      <div class="modal-actions">
        <button type="button" id="completeTaskCancel" class="btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Completion</button>
      </div>
    </form>
  </dialog>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-tab="tasks">
      <span>üìã</span>
      <span>Tasks</span>
    </button>
    <button class="nav-btn" data-tab="inventory">
      <span>üß™</span>
      <span>Inventory</span>
    </button>
    <button class="nav-btn" data-tab="readings">
      <span>üìä</span>
      <span>Readings</span>
    </button>
    <button class="nav-btn" data-tab="settings">
      <span>‚öôÔ∏è</span>
      <span>Settings</span>
    </button>
  </nav>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="./js/app.js?v=4"></script>
</body>
</html>